<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Case opener</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    #balance {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .container { width: 300px; height: 100px; overflow: hidden; margin: 20px auto; border: 2px solid #333; position: relative; }
    .items { display: flex; transition: transform 4s cubic-bezier(0.25, 1, 0.5, 1); will-change: transform; }
    .item {
      box-sizing: border-box;
      flex: 0 0 100px;
      height: 100px;
      border-right: 1px solid #ccc;
      background: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .item img { max-width: 90px; max-height: 90px; }
    .marker { position: absolute; top: 0; left: 50%; width: 2px; height: 100%; background: red; transform: translateX(-50%); }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 12px; text-align: center; width: 260px; animation: pop .3s ease-out; }
    @keyframes pop { from { transform: scale(.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .modal-content img { max-width: 200px; margin-bottom: 8px; }
    .close { margin-top: 10px; background: #333; color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="balance">Saldo: 100.00 zł</div>
	<p>koszt 18 zł</p>
  <div class="container">
    <div class="items"></div>
    <div class="marker"></div>
  </div>

  <button id="open">Otwórz</button>
  
  
  <div id="winModal" class="modal">
    <div class="modal-content">
      <img id="modalImg" alt="wygrana">
      <p id="modalText"></p>
      <p id="modalCost"></p>
      <button class="close" id="closeBtn">OK</button>
    </div>
  </div>

  <script>
    const items = [
      {img: "uspforestleaves.jpg", chance: 30, cost: 0.5},
      {img: "uspnightops.jpg", chance: 30, cost: 0.5},
      {img: "uspcortex.jpg", chance: 15, cost: 9.00},
      {img: "uspblueprint.jpg", chance: 15, cost: 15.00},
      {img: "uspneonoir.jpg", chance: 3, cost: 70.00},
      {img: "uspmonstermashup.jpg", chance: 3, cost: 90.00},
      {img: "uspprintstream.jpg", chance: 2, cost: 160.00},
      {img: "uspcaiman.jpg", chance: 1, cost: 250.00},
      {img: "uspkillconfirmed.jpg", chance: 1, cost: 350.00}
    ];

    const OPEN_COST = 18;

    const track     = document.querySelector('.items');
    const btn       = document.getElementById('open');
    const modal     = document.getElementById('winModal');
    const modalImg  = document.getElementById('modalImg');
    const modalText = document.getElementById('modalText');
    const modalCost = document.getElementById('modalCost');
    const closeBtn  = document.getElementById('closeBtn');
    const balanceEl = document.getElementById('balance');

    let balance = 100;

    const COPIES = 50;
    for (let c = 0; c < COPIES; c++) {
      items.forEach(i => {
        const div = document.createElement('div');
        div.className = 'item';
        const img = document.createElement('img');
        img.src = i.img;
        div.appendChild(img);
        track.appendChild(div);
      });
    }

    function weightedRandom(list) {
      const total = list.reduce((s, i) => s + i.chance, 0);
      let r = Math.random() * total;
      for (let i = 0; i < list.length; i++) {
        if (r < list[i].chance) return i;
        r -= list[i].chance;
      }
      return list.length - 1;
    }

    function fileNameNoExt(path) {
      const file = path.split('/').pop().split('\\').pop();
      return file.replace(/\.[^/.]+$/, '');
    }

    const TILE_W     = 100;
    const ROLL_MS    = 4000;
    const BASE_INDEX = Math.floor(COPIES / 2) * items.length;

    track.style.transition = "none";
    track.style.transform  = `translateX(${(TILE_W) - BASE_INDEX * TILE_W}px)`;

    let busy = false;

    function updateBalanceDisplay() {
      balanceEl.textContent = `Saldo: ${balance.toFixed(2)} zł`;
      btn.disabled = balance < OPEN_COST || busy;
    }

    updateBalanceDisplay();

    btn.addEventListener('click', () => {
      if (busy || balance < OPEN_COST) return;
      busy = true;
      updateBalanceDisplay();

      balance -= OPEN_COST;
      updateBalanceDisplay();

      const idx = weightedRandom(items);
      const extraLaps   = 5;
      const targetIndex = BASE_INDEX + items.length * extraLaps + idx;
      const targetOffset= TILE_W - targetIndex * TILE_W;

      track.style.transition = `transform ${ROLL_MS/1000}s cubic-bezier(0.25, 1, 0.5, 1)`;
      track.style.transform  = `translateX(${targetOffset}px)`;

      setTimeout(() => {
        const chosen = items[idx];

        track.style.transition = "none";
        const resetIndex  = BASE_INDEX + idx;
        const resetOffset = TILE_W - resetIndex * TILE_W;
        track.style.transform = `translateX(${resetOffset}px)`;

        modalImg.src = chosen.img;
        modalText.textContent = fileNameNoExt(chosen.img);
        modalCost.textContent = `Koszt: ${chosen.cost.toFixed(2)} zł`;
        modal.style.display = 'flex';

        balance += chosen.cost;
        updateBalanceDisplay();

      }, ROLL_MS);
    });

    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
      busy = false;
      updateBalanceDisplay();
    });
  </script>
</body>
</html>
