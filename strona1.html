<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Case opener</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .balance { font-size: 20px; margin-bottom: 20px; }
    .clicker { margin-bottom: 30px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    .case { margin: 40px auto; }
    .container { width: 300px; height: 100px; overflow: hidden; margin: 10px auto; border: 2px solid #333; position: relative; }
    .items { display: flex; will-change: transform; transform: translate3d(0,0,0); }
    .item { flex: 0 0 100px; height: 100px; background: #eee; display: flex; align-items: center; justify-content: center; box-shadow: inset -1px 0 0 #ccc; }
    .item img { max-width: 90px; max-height: 90px; }
    .marker { position: absolute; top: 0; left: 50%; width: 2px; height: 100%; background: red; transform: translateX(-50%); }
    .controls { margin-top: 10px; }
    button { padding: 6px 12px; margin: 0 5px; cursor: pointer; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 12px; text-align: center; width: 300px; max-height: 80vh; overflow-y: auto; }
    .modal-content img { max-width: 200px; margin-bottom: 8px; }
    .close { margin-top: 10px; background: #333; color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; font-size: 14px; }
    th { background: #eee; }
  </style>
</head>
<body>
  <div class="balance">Saldo: <span id="balance">100.00</span> zł</div>
  <button class="clicker" id="clicker">Kliknij +1 zł</button>

  <div id="cases"></div>

  <div id="winModal" class="modal">
    <div class="modal-content">
      <img id="modalImg" alt="wygrana">
      <p id="modalText"></p>
      <p id="modalCost"></p>
      <button class="close" id="closeWinBtn">OK</button>
    </div>
  </div>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <h3>Szanse i ceny</h3>
      <table id="infoTable"></table>
      <button class="close" id="closeInfoBtn">Zamknij</button>
    </div>
  </div>

<script>
const items1 = [
  {img: "uspforestleaves.jpg", chance: 30, cost: 0.5},
  {img: "uspnightops.jpg", chance: 30, cost: 0.5},
  {img: "uspcortex.jpg", chance: 15, cost: 9.00},
  {img: "uspblueprint.jpg", chance: 15, cost: 15.00},
  {img: "uspneonoir.jpg", chance: 3, cost: 70.00},
  {img: "uspmonstermashup.jpg", chance: 3, cost: 90.00},
  {img: "uspprintstream.jpg", chance: 2, cost: 160.00},
  {img: "uspcaiman.jpg", chance: 1, cost: 250.00},
  {img: "uspkillconfirmed.jpg", chance: 1, cost: 350.00}
];

const items2 = [
  {img: "ak47safarimesh.jpg", chance: 30, cost: 0.5},
  {img: "ak47crossfade.jpg", chance: 30, cost: 4.00},
  {img: "ak47icecoald.jpg", chance: 15, cost: 25.00},
  {img: "ak47searingrage.jpg", chance: 8, cost: 30.00},
  {img: "ak47headshot.jpg", chance: 7, cost: 40.00},
  {img: "ak47midnightlaminate.jpg", chance: 5, cost: 80.00},
  {img: "ak47frontsidemisty.jpg", chance: 4, cost: 110.00},
  {img: "ak47inharitance.jpg", chance: 1, cost: 500.00}
];

const items3 = [
  {img: "awpsafarimesh.jpg", chance: 30, cost: 0.5},
  {img: "awppitviper.jpg", chance: 30, cost: 2.00},
  {img: "awpmortis.jpg", chance: 15, cost: 10.00},
  {img: "awpatheris.jpg", chance: 15, cost: 15.00},
  {img: "awpexoskeleton.jpg", chance: 5, cost: 30.00},
  {img: "awpelitebuild.jpg", chance: 2, cost: 120.00},
  {img: "awphyperbeast.jpg", chance: 2, cost: 180.00},
  {img: "awpwildfire.jpg", chance: 1, cost: 350.00},
  {img: "awpboom.jpg", chance: 0.5, cost: 700.00}
];

let balance = 100.00;

const balanceEl = document.getElementById("balance");
const winModal = document.getElementById("winModal");
const modalImg = document.getElementById("modalImg");
const modalText = document.getElementById("modalText");
const modalCost = document.getElementById("modalCost");
const closeWinBtn = document.getElementById("closeWinBtn");
const infoModal = document.getElementById("infoModal");
const infoTable = document.getElementById("infoTable");
const closeInfoBtn = document.getElementById("closeInfoBtn");

document.getElementById("clicker").addEventListener("click", () => {
  balance += 1;
  balanceEl.textContent = balance.toFixed(2);
});

function weightedRandom(list) {
  const total = list.reduce((s, i) => s + i.chance, 0);
  let r = Math.random() * total;
  for (let i = 0; i < list.length; i++) {
    if (r < list[i].chance) return i;
    r -= list[i].chance;
  }
  return list.length - 1;
}

function fileNameNoExt(path) {
  const file = path.split('/').pop().split('\\').pop();
  return file.replace(/\.[^/.]+$/, '');
}

function createCase(items, openCost) {
  const caseDiv = document.createElement("div");
  caseDiv.className = "case";

  const container = document.createElement("div");
  container.className = "container";
  const track = document.createElement("div");
  track.className = "items";
  container.appendChild(track);
  const marker = document.createElement("div");
  marker.className = "marker";
  container.appendChild(marker);

  const COPIES = 50;
  for (let c = 0; c < COPIES; c++) {
    items.forEach(i => {
      const div = document.createElement("div");
      div.className = "item";
      const img = document.createElement("img");
      img.src = i.img;
      div.appendChild(img);
      track.appendChild(div);
    });
  }

  const controls = document.createElement("div");
  controls.className = "controls";
  const btn = document.createElement("button");
  btn.textContent = `Otwórz (${openCost} zł)`;
  const infoBtn = document.createElement("button");
  infoBtn.textContent = "Szanse";
  controls.appendChild(btn);
  controls.appendChild(infoBtn);

  caseDiv.appendChild(container);
  caseDiv.appendChild(controls);
  document.getElementById("cases").appendChild(caseDiv);

  const ROLL_MS = 4000;
  let busy = false;
  const tileW = track.querySelector('.item').offsetWidth;
  const contW = container.clientWidth;
  const centerShift = Math.round(contW / 2 - tileW / 2);
  const MID_BASE = Math.floor(COPIES / 2) * items.length;

  function setInstantTo(indexAbs) {
    track.style.transition = 'none';
    track.style.transform = `translate3d(${centerShift - indexAbs * tileW}px,0,0)`;
  }
  function animateTo(indexAbs) {
    track.style.transition = `transform ${ROLL_MS}ms cubic-bezier(0.25, 1, 0.5, 1)`;
    track.style.transform  = `translate3d(${centerShift - indexAbs * tileW}px,0,0)`;
  }

  setInstantTo(MID_BASE);

  btn.addEventListener("click", () => {
    if (busy) return;
    if (balance < openCost) { alert("Za mało środków!"); return; }
    busy = true;
    balance -= openCost;
    balanceEl.textContent = balance.toFixed(2);

    const idx = weightedRandom(items);
    const laps = 6;
    const targetAbs = MID_BASE + laps * items.length + idx;

    animateTo(targetAbs);

    const onEnd = () => {
      track.removeEventListener('transitionend', onEnd);
      const chosen = items[idx];
      setInstantTo(MID_BASE + idx);

      balance += chosen.cost;
      balanceEl.textContent = balance.toFixed(2);

      modalImg.src = chosen.img;
      modalText.textContent = fileNameNoExt(chosen.img);
      modalCost.textContent = `Koszt: ${chosen.cost.toFixed(2)} zł`;
      winModal.style.display = 'flex';

      busy = false;
    };
    track.addEventListener('transitionend', onEnd, { once: true });
  });

  infoBtn.addEventListener("click", () => {
    infoTable.innerHTML = "<tr><th>Przedmiot</th><th>Szansa</th><th>Cena</th></tr>";
    items.forEach(i => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${fileNameNoExt(i.img)}</td><td>${i.chance}%</td><td>${i.cost.toFixed(2)} zł</td>`;
      infoTable.appendChild(tr);
    });
    infoModal.style.display = "flex";
  });
}

createCase(items1, 18);
createCase(items2, 25);
createCase(items3, 20);

closeWinBtn.addEventListener("click", () => winModal.style.display = "none");
closeInfoBtn.addEventListener("click", () => infoModal.style.display = "none");
</script>
</body>
</html>
